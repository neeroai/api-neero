{
  "project": "api-neero",
  "version": "3.0.0",
  "lastUpdated": "2025-12-24T12:30:00Z",
  "features": [
    {
      "id": "F001",
      "name": "Data Collection (1 Message)",
      "description": "Collects 5 fields (name, phone, email, country, procedure) in free-form format with upsertLeadTool",
      "status": "completed",
      "priority": "P0",
      "steps": [
        {
          "id": "S001",
          "description": "Implement upsertLeadTool with insert + update logic",
          "status": "completed"
        },
        {
          "id": "S002",
          "description": "Create leads table with conversation_id unique index",
          "status": "completed"
        },
        {
          "id": "S003",
          "description": "Integrate with Bird Contacts API for CRM sync",
          "status": "completed"
        },
        {
          "id": "S004",
          "description": "Create automated validation script",
          "status": "completed"
        }
      ],
      "acceptance": [
        "Accepts free-form format with 87% completion rate target",
        "Updates Bird Contact after lead upsert",
        "All validation tests passing (165 lines script)",
        "Handles duplicate conversation_id gracefully"
      ],
      "implementation": "/lib/agent/tools/crm.ts",
      "validation": "scripts/validate-f001-data-collection.ts"
    },
    {
      "id": "F002",
      "name": "Price Inquiry Handover",
      "description": "Two-layer architecture (AI proactive + guardrails reactive) to detect pricing questions and escalate to human",
      "status": "completed",
      "priority": "P0",
      "steps": [
        {
          "id": "S001",
          "description": "Implement createTicket tool with reason='pricing'",
          "status": "completed"
        },
        {
          "id": "S002",
          "description": "Add 14 pricing keywords to guardrails detection",
          "status": "completed"
        },
        {
          "id": "S003",
          "description": "Create conversation_state handover tracking",
          "status": "completed"
        },
        {
          "id": "S004",
          "description": "Create automated validation script",
          "status": "completed"
        }
      ],
      "acceptance": [
        "Detects pricing questions with two-layer architecture",
        "Creates structured ticket with reason='pricing'",
        "Updates conversation_state with requiresHuman=true",
        "All validation tests passing (210 lines script)",
        "Known limitation: Guardrails only detect responses with '$', relies on AI for questions"
      ],
      "implementation": "/lib/agent/guardrails.ts, /lib/agent/tools/crm.ts",
      "validation": "scripts/validate-f002-pricing-handover.ts"
    },
    {
      "id": "F003",
      "name": "Location Triage",
      "description": "Immediate location responses for Bogotá/Barranquilla, virtual offer for other Colombia, escalate outside Colombia",
      "status": "blocked",
      "priority": "P0",
      "blocker": "Feature marked DONE but NO code exists - CRITICAL BLOCKER affecting 28% of conversations (310/1,106)",
      "steps": [
        {
          "id": "S001",
          "description": "Create SPEC.md with problem, contracts, rules, DoD",
          "status": "pending"
        },
        {
          "id": "S002",
          "description": "Create PLAN.md with implementation steps",
          "status": "pending"
        },
        {
          "id": "S003",
          "description": "Create TASKS.md with 1-4hr task breakdown",
          "status": "pending"
        },
        {
          "id": "S004",
          "description": "Create TESTPLAN.md with 80%+ coverage strategy",
          "status": "pending"
        },
        {
          "id": "S005",
          "description": "Implement location detection logic",
          "status": "pending"
        },
        {
          "id": "S006",
          "description": "Add location tool or prompt instructions",
          "status": "pending"
        },
        {
          "id": "S007",
          "description": "Write unit and integration tests",
          "status": "pending"
        }
      ],
      "acceptance": [
        "Bogotá: Provide address + offer valoración",
        "Barranquilla: Provide address (Cra 52 #82-110) + offer valoración",
        "Other Colombia cities: Offer virtual valoración",
        "Outside Colombia: Escalate to coordinator",
        "80%+ test coverage (unit + integration)",
        "Handles ambiguous city names, typos, Spanish/English queries"
      ],
      "implementation": "TBD - /lib/agent/location.ts or prompt-based",
      "validation": "TBD - scripts/validate-f003-location-triage.ts"
    },
    {
      "id": "F004",
      "name": "Photo Quality Analysis",
      "description": "Consent-based photo analysis with Gemini 2.0 Flash providing quality feedback (no diagnosis)",
      "status": "completed",
      "priority": "P1",
      "steps": [
        {
          "id": "S001",
          "description": "Implement analyzePhotoTool with consent checking",
          "status": "completed"
        },
        {
          "id": "S002",
          "description": "Create consents table with type='photo_analysis'",
          "status": "completed"
        },
        {
          "id": "S003",
          "description": "Integrate Gemini 2.0 Flash for quality analysis",
          "status": "completed"
        },
        {
          "id": "S004",
          "description": "Add guardrails to prevent medical diagnosis",
          "status": "completed"
        },
        {
          "id": "S005",
          "description": "Create automated validation script",
          "status": "completed"
        }
      ],
      "acceptance": [
        "Explicit consent requested before first photo processing (photoCount === 0)",
        "Quality feedback: lighting, angle, distance, focus",
        "NO medical diagnosis in responses",
        "Processing time <6s (target: 3.1s actual)",
        "All validation tests passing (160 lines script)",
        "Photos NOT stored (process in memory, discard)"
      ],
      "implementation": "/lib/agent/tools/media.ts, /lib/agent/consent.ts",
      "validation": "scripts/validate-f004-photo-quality.ts"
    },
    {
      "id": "F005",
      "name": "Audio Transcription",
      "description": "Groq Whisper v3 primary + OpenAI Whisper fallback for Spanish voice notes",
      "status": "completed",
      "priority": "P1",
      "steps": [
        {
          "id": "S001",
          "description": "Implement transcribeAudioTool integration",
          "status": "completed"
        },
        {
          "id": "S002",
          "description": "Add Groq Whisper v3 as primary provider",
          "status": "completed"
        },
        {
          "id": "S003",
          "description": "Add OpenAI Whisper as fallback provider",
          "status": "completed"
        },
        {
          "id": "S004",
          "description": "Implement Spanish language optimization",
          "status": "completed"
        },
        {
          "id": "S005",
          "description": "Add optional Groq text post-processing",
          "status": "completed"
        },
        {
          "id": "S006",
          "description": "Create automated validation script",
          "status": "completed"
        }
      ],
      "acceptance": [
        "Primary: Groq Whisper v3 (95% success rate, $0.67/1K min)",
        "Fallback: OpenAI Whisper (5% when Groq fails, $6.00/1K min)",
        "Spanish language optimization enabled",
        "228x realtime processing speed",
        "All validation tests passing (235 lines script)",
        "Processing time within budget"
      ],
      "implementation": "/lib/ai/transcribe.ts, /lib/ai/groq.ts, /lib/ai/openai-whisper.ts",
      "validation": "scripts/validate-f005-audio-transcription.ts"
    },
    {
      "id": "F006",
      "name": "Guardrails Compliance",
      "description": "Pre-send validation with 66 keywords across 3 severity levels to prevent medical/legal violations",
      "status": "completed",
      "priority": "P0",
      "steps": [
        {
          "id": "S001",
          "description": "Implement guardrails validation with 66 keywords",
          "status": "completed"
        },
        {
          "id": "S002",
          "description": "Define 3 severity levels (critical, high, medium)",
          "status": "completed"
        },
        {
          "id": "S003",
          "description": "Add auto-handover on critical violations",
          "status": "completed"
        },
        {
          "id": "S004",
          "description": "Create comprehensive validation script",
          "status": "completed"
        }
      ],
      "acceptance": [
        "66 keywords detection: diagnosis, prescription, guarantees, pricing",
        "Critical (22): Auto-handover + log",
        "High (24): Auto-handover + log",
        "Medium (20): Warning + log",
        "All validation tests passing (360 lines script)",
        "Zero violations in 100-conversation test"
      ],
      "implementation": "/lib/agent/guardrails.ts",
      "validation": "scripts/validate-f006-guardrails.ts"
    }
  ],
  "summary": {
    "total": 6,
    "completed": 5,
    "inProgress": 0,
    "blocked": 1,
    "pending": 0,
    "completionRate": "83%"
  },
  "notes": [
    "F003 is CRITICAL BLOCKER affecting 28% of conversations (310/1,106)",
    "All completed features have automated validation scripts passing",
    "v1.0 MVP blocked until F003 implemented",
    "SDD methodology being implemented for F003"
  ]
}
